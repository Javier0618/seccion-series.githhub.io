<!DOCTYPE
html >
  <html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sección Series</title>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://api.themoviedb.org">
    <link rel="preconnect" href="https://image.tmdb.org">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
  	<style>
      :root {
        --background-primary: #121212;
        --background-secondary: #1e1e1e;
        --text-primary: #ffffff;
        --text-secondary: #dedede;
        --accent-primary: #e50914;
        --accent-secondary: #f5c518;
        --ui-element: #2c2c2c;
        --ui-hover: #454545;
      }

.license-dialog {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 9999;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .license-content {
      background-color: #222;
      padding: 30px;
      border-radius: 10px;
      width: 80%;
      max-width: 500px;
      text-align: center;
    }

    .license-title {
      color: #e50914;
      margin-top: 0;
    }

    .license-description {
      color: #dedede;
      margin-bottom: 20px;
    }

    .license-input-group {
      margin-bottom: 15px;
    }

    .license-label {
      display: block;
      color: #fff;
      margin-bottom: 5px;
    }

    .license-input {
      width: 100%;
      padding: 10px;
      border-radius: 5px;
      border: none;
      text-align: center;
      background-color: #333;
      color: white;
    }

    .license-button {
      background-color: #e50914;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
    }

    .license-message {
      margin-top: 15px;
      color: #ff6b6b;
      display: none;
    }

    .license-status {
      position: fixed;
      bottom: 10px;
      right: 10px;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 12px;
      z-index: 1000;
    }

    .license-valid {
      background-color: #16a34a;
      color: white;
    }

    .license-invalid {
      background-color: #e11d48;
      color: white;
      animation: pulse 2s infinite;
    }

    .license-toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 20px;
      border-radius: 5px;
      color: white;
      z-index: 10000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .license-toast-success {
      background-color: #16a34a;
    }

    .license-toast-error {
      background-color: #e11d48;
    }

    @keyframes pulse {
      0% {
        opacity: 1;
      }

      50% {
        opacity: 0.7;
      }

      100% {
        opacity: 1;
      }
    }

      body {
        font-family: "Arial", sans-serif;
        background-color: var(--background-primary);
        color: var(--text-primary);
        text-align: center;
        margin: 0;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        overflow-x: hidden;
      }
      header {
        background-color: var(--background-secondary);
        color: var(--text-primary);
        padding: 0.2rem 0;
        display: flex;
        position: sticky;
        top: 0;
        z-index: 1000;
        align-items: center;
        height: 40px;
      }

      .header-content {
        flex: 1;
        display: flex;
        justify-content: center;
      }

      .logo {
        margin-left: 0.2rem;
      }

      h1 {
        display: flex;
        font-size: 1.5rem;
        margin: 0;
        padding: 0;
        flex-wrap: nowrap;
        text-align: center;
        align-items: center;
      }

      .highlight {
        color: var(--accent-primary);
      }

      .secondary-highlight {
        color: var(--accent-secondary);
      }

      .back-link,
      .report {
        display: block;
        text-decoration: none;
        color: var(--text-secondary);
        padding: 10px;
        font-size: 1.2rem;
        transition: color 0.3s ease, background-color 0.3s ease;
      }

      .back-link:hover,
      .report:hover {
        color: var(--text-primary);
        background-color: var(--ui-hover);
      }

      .series-info-container {
        display: flex;
        justify-content: center;
        margin-top: 0;
        margin-bottom: 20px;
        position: sticky;
        top: 40px;
      }

      .series-info {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        max-width: 1000px;
        margin: 0 auto;
        text-align: left;
        padding: 10px;
        background-color: var(--background-secondary);
        border-radius: 10px;
      }
     
            /* Estilos para pantallas de 600px y superiores */
      @media (min-width: 1401px) {
        .streamfusion {
            font-weight: bold;
            background: linear-gradient(90deg, red 0%, red 50%, yellow 50%, yellow 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        header {
          background-color: var(--background-secondary);
          color: var(--text-primary);
          padding: 0.2rem 0;
          display: flex;
          position: sticky;
          top: 0;
          z-index: 1000;
          align-items: center;
          height: 40px;
        }

        .container {
          display: flex;
          height: calc(100vh - 40px);
        }

        .player {
          display: flex;
          width: 60%;
          height: 100%;
          position: sticky;
          top: 40px;
          background-color: var(--background-primary);
          flex-direction: column;
        }

        .videoPlayer {
          height: calc(100% - 40px);
          padding: 1vw;
          position: relative;
        }

        .videoPlayer iframe {
          width: 100%;
          height: 100%;
          border: 2px solid var(--accent-secondary);
          border-radius: 10px;
        }

        .sidebar {
          width: 40%;
          padding: 5px;
          box-sizing: border-box;
          overflow-y: auto;
          height: 100%;
        }

        .series-details {
          flex: 0 0 70%;
          max-width: 70%;
          background-color: var(--background-secondary);
          padding-left: 10px;
          border-radius: 10px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
          flex-direction: column;
          max-height: 100%;
        }

        .series-details h2 {
          font-size: 1.5vw;
          line-height: 1;
          margin-bottom: 0;
          margin-top: 0;
          color: var(--accent-secondary);
        }

        .series-details p {
          font-size: 1.3vw;
          line-height: 0.9;
          margin-bottom: 8px;
          color: var(--text-secondary);
        }

        .recommended-series {
          display: none;
        }

        .recommended-series-2 {
          display: flex;
          height: 40%;
          overflow-x: auto;
          scroll-snap-type: x mandatory;
          margin: 0.5vw;
          border-radius: 10px;
        }
            .recommended-series-2 .content-2 {
                display: flex;
                scroll-snap-type: x mandatory;
                overflow-x: auto;
                padding-bottom: 10px;
            }

        .recommended-series-2 .item {
          flex: none;
          width: 200px;
          padding-right: 0.3em;
          text-align: center;
          position: relative;
          overflow: hidden;
        }

        .recommended-series-2 .item img {
          width: 100%;
          max-width: 100%;
          height: auto;
          border-radius: 10px;
          transition: transform 0.3s ease;
        }

        .recommended-series-2 .item:hover img {
          transform: scale(1.05);
        }

        .recommended-series-2 .item-title {
          margin-top: 5px;
          font-size: 14px;
          text-align: center;
          color: var(--text-primary);
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          background-color: rgba(0, 0, 0, 0.7);
          padding: 5px;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          border-bottom-left-radius: 10px;
          border-bottom-right-radius: 10px;
        }

        .recommended-series-2 a {
          text-decoration: none;
          color: inherit;
          display: block;
        }

        .text-h3-1 {
          display: none;
        }

        .text-h3-0 {
          padding-top: 0.5vw;
        }

        .series-seasons {
          background-color: var(--ui-element);
          padding: 15px;
          border-radius: 10px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
          max-width: 1000px;
          margin: 15px auto;
          text-align: left;
          font-size: 1.3em;
          color: var(--text-secondary);
        }

        html,
        body {
          margin: 0;
          padding: 0;
          overflow: hidden;
        }
        .rating-badge {
          position: absolute;
          top: 8px;
          left: 8px;
          background: rgba(0, 0, 0, 0.7);
          color: #FFD700;
          font-size: 14px;
          font-weight: bold;
          padding: 4px 4px;
          border-radius: 5px;
        }
      }

      /* Estilos para pantallas de 600px y superiores */
      @media (min-width: 600px) and (max-width: 1400px) {
        .streamfusion {
            font-weight: bold;
            background: linear-gradient(90deg, red 0%, red 50%, yellow 50%, yellow 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        header {
          background-color: var(--background-secondary);
          color: var(--text-primary);
          padding: 0.2rem 0;
          display: flex;
          position: sticky;
          top: 0;
          z-index: 1000;
          align-items: center;
          height: 40px;
        }

        .container {
          display: flex;
          height: calc(100vh - 40px);
        }

        .player {
          display: flex;
          width: 60%;
          height: 100%;
          position: sticky;
          top: 40px;
          background-color: var(--background-primary);
          flex-direction: column;
        }

        .videoPlayer {
          height: calc(100% - 40px);
          padding: 1vw;
          position: relative;
        }

        .videoPlayer iframe {
          width: 100%;
          height: 100%;
          border: 2px solid var(--accent-secondary);
          border-radius: 10px;
        }
            h3 {
                font-size: 1rem;
                margin-top: 1px;
                margin-bottom: 1px;
                color: var(--text-secondary);
            }

        .sidebar {
          width: 40%;
          padding: 5px;
          box-sizing: border-box;
          overflow-y: auto;
          height: 100%;
        }

        .series-details {
          flex: 0 0 70%;
          max-width: 70%;
          background-color: var(--background-secondary);
          padding-left: 10px;
          border-radius: 10px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
          flex-direction: column;
          max-height: 100%;
        }

        .series-details h2 {
          font-size: 1.5vw;
          line-height: 1;
          margin-bottom: 0;
          margin-top: 0;
          color: var(--accent-secondary);
        }

        .series-details p {
          font-size: 1.3vw;
          line-height: 0.9;
          margin-bottom: 8px;
          color: var(--text-secondary);
        }

        .recommended-series {
          display: none;
        }

        .recommended-series-2 {
          display: flex;
          height: 40%;
          overflow-x: auto;
          scroll-snap-type: x mandatory;
          margin: 0.5vw;
          border-radius: 10px;
        }
            .recommended-series-2 .content-2 {
                display: flex;
                scroll-snap-type: x mandatory;
                overflow-x: auto;
                padding-bottom: 10px;
            }

        .recommended-series-2 .item {
          flex: none;
          width: 120px;
          padding-right: 0.3em;
          text-align: center;
          position: relative;
          overflow: hidden;
        }

        .recommended-series-2 .item img {
          width: 100%;
          max-width: 100%;
          height: auto;
          border-radius: 10px;
          transition: transform 0.3s ease;
        }

        .recommended-series-2 .item:hover img {
          transform: scale(1.05);
        }

        .recommended-series-2 .item-title {
          margin-top: 5px;
          font-size: 14px;
          text-align: center;
          color: var(--text-primary);
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          background-color: rgba(0, 0, 0, 0.7);
          padding: 5px;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          border-bottom-left-radius: 10px;
          border-bottom-right-radius: 10px;
        }

        .recommended-series-2 a {
          text-decoration: none;
          color: inherit;
          display: block;
        }

        .text-h3-1 {
          display: none;
        }

        .text-h3-0 {
          padding-top: 0.5vw;
        }

        .series-seasons {
          background-color: var(--ui-element);
          padding: 15px;
          border-radius: 10px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
          max-width: 1000px;
          margin: 15px auto;
          text-align: left;
          font-size: 1.3em;
          color: var(--text-secondary);
        }

        html,
        body {
          margin: 0;
          padding: 0;
          overflow: hidden;
        }
.rating-badge {
    position: absolute;
    top: 8px;
    left: 8px;
    background: rgba(0, 0, 0, 0.7);
    color: #FFD700;
    font-size: 14px;
    font-weight: bold;
    padding: 4px 4px;
    border-radius: 5px;
}
      }

      /* Estilos para pantallas menores a 600px */
      @media (max-width: 599px) {
        .streamfusion {
            font-weight: bold;
            background: linear-gradient(90deg, red 0%, red 50%, yellow 50%, yellow 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        header {
          background-color: var(--background-secondary);
          color: var(--text-primary);
          padding: 0.2rem 0;
          display: flex;
          position: sticky;
          top: 0;
          height: 40px;
          z-index: 1000;
          align-items: center;
        }

        .player {
          height: 230px;
          position: sticky;
          top: 40px;
          background-color: var(--background-primary);
          z-index: 1;
        }

        .videoPlayer {
          height: 100%;
          background: var(--background-primary);
        }

        .videoPlayer iframe {
          width: 100%;
          height: 100%;
          border-bottom: 2px solid var(--accent-secondary);
          border-end-start-radius: 2vw;
          border-end-end-radius: 2vw;
        }

        .content {
          padding: 5px;
        }

        .series-details {
          flex: 0 0 70%;
          max-width: 70%;
          background-color: var(--background-secondary);
          padding-left: 10px;
          border-radius: 10px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
          flex-direction: column;
        }

        .series-details h2 {
          font-size: 4vw;
          line-height: 1.1;
          margin-bottom: 8px;
          margin-top: 0;
          color: var(--accent-secondary);
        }

        .series-details p {
          font-size: 3vw;
          line-height: 1.1;
          margin-bottom: 8px;
          color: var(--text-secondary);
        }

        .recommended-series-2 {
          display: none;
        }

        .text-h3-0 {
          display: none;
        }

        .recommended-series .content{
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 5px;
          margin-top: 5px;
        }

        .recommended-series .item {
          text-align: center;
          position: relative;
          overflow: hidden;
        }

        .recommended-series .item img {
          width: 100%;
          max-width: 100%;
          height: auto;
          border-radius: 10px;
          transition: transform 0.3s ease;
        }

        .recommended-series .item:hover img {
          transform: scale(1.05);
        }

        .recommended-series .item-title {
          margin-top: 5px;
          font-size: 14px;
          text-align: center;
          color: var(--text-primary);
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          background-color: rgba(0, 0, 0, 0.7);
          padding: 5px;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          border-bottom-left-radius: 10px;
          border-bottom-right-radius: 10px;
        }

        .recommended-series a {
          text-decoration: none;
          color: inherit;
          display: block;
        }

        .series-seasons {
          background-color: var(--ui-element);
          padding: 10px;
          border-radius: 10px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
          max-width: 1000px;
          margin: 10px auto;
          text-align: left;
          color: var(--text-secondary);
        }
      }

      /* Estilos comunes */
      h3 {
        font-size: 1rem;
        margin-top: 1px;
        margin-bottom: 1px;
        color: var(--text-secondary);
      }

      .series-poster {
        flex: 0 0 30%;
        max-width: 30%;
      }

      #seriesPoster {
        max-width: 100%;
        height: auto;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        border-radius: 10px;
      }

      .series-seasons-1 {
        text-align: center;
      }

      .season-dropdown {
        margin-top: 10px;
        display: flex;
        justify-content: center;
      }

      .season-dropdown select {
        font-size: 16px;
        padding: 10px;
        border: none;
        border-radius: 10px;
        background-color: var(--ui-element);
        color: var(--text-primary);
        cursor: pointer;
        appearance: none;
      }

      .season-dropdown select:hover {
        background-color: var(--ui-hover);
      }

      .season-dropdown select:focus {
        outline: none;
        box-shadow: 0 0 0 2px var(--ui-hover);
      }

      .episodes-slider {
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        margin-top: 10px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .episodes-slider::-webkit-scrollbar {
        display: none;
      }

      .episodes-slider .episode {
        flex: 0 0 auto;
        width: 7vh;
        height: 7vh;
        margin: 0.3vw;
        background: var(--ui-element);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        scroll-snap-align: start;
        font-size: 1.5em;
        color: var(--text-primary);
        cursor: pointer;
      }

      .episode.selected {
        background-color: var(--accent-primary);
        color: var(--text-primary);
      }
      .rating-badge {
          position: absolute;
          top: 8px;
          left: 8px;
          background: rgba(0, 0, 0, 0.7);
          color: #FFD700;
          font-size: 14px;
          font-weight: bold;
          padding: 4px 4px;
          border-radius: 5px;
      }

      .reload-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
            z-index: 10;
        }

        .reload-button:hover {
            background-color: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }

        .reload-button:active {
            transform: scale(0.95);
        }

        .reload-button i {
            transition: transform 0.5s;
        }

        .reload-button.loading i {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .videoPlayer {
            position: relative;
        }

/* Loading spinner */
.page-loader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(18, 18, 18, 0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    transition: opacity 0.5s ease;
}

.page-loader.hidden {
    opacity: 0;
    pointer-events: none;
}

.loading-spinner {
    width: 50px;
    height: 50px;
    border: 5px solid var(--ui-element);
    border-radius: 50%;
    border-top-color: var(--accent-primary);
    animation: spin 1s ease-in-out infinite;
}

/* Fallback poster */
.fallback-poster {
    background-color: var(--ui-element);
    display: flex;
    justify-content: center;
    align-items: center;
    color: var(--text-secondary);
    font-size: 14px;
    border-radius: 10px;
}

/* Animations */
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
        <b:skin><![CDATA[
            body {display: block !important;}
        ]]></b:skin>
  	</style>
    <script>
const apiKey = "32e5e53999e380a0291d66fb304153fe"
const seriesId = 207468; // ID de la serie que quieres consultar (por ejemplo, Stranger Things)
const episodeVideos = {
  1: {
    1: "https://www.youtube.com/embed/K9oq3i3mmnY?si=SJH1wZsLekAFYbkM",
    2: "https://www.youtube.com/embed/zhXaZ4pL8gQ?si=JKb5L-4ogEIlcZm6",
    3: "https://www.youtube.com/embed/TRXbzBGDKAE?si=9Ciwg98qPIp5ML_G",
    4: "https://www.youtube.com/embed/K9oq3i3mmnY?si=SJH1wZsLekAFYbkM",
    5: "https://www.youtube.com/embed/zhXaZ4pL8gQ?si=JKb5L-4ogEIlcZm6",
    6: "https://www.youtube.com/embed/TRXbzBGDKAE?si=9Ciwg98qPIp5ML_G",
    7: "https://www.youtube.com/embed/K9oq3i3mmnY?si=SJH1wZsLekAFYbkM",
    8: "https://www.youtube.com/embed/zhXaZ4pL8gQ?si=JKb5L-4ogEIlcZm6",
    9: "https://www.youtube.com/embed/K9oq3i3mmnY?si=SJH1wZsLekAFYbkM",
    10: "https://www.youtube.com/embed/TRXbzBGDKAE?si=9Ciwg98qPIp5ML_G",
    11: "https://www.youtube.com/embed/zhXaZ4pL8gQ?si=JKb5L-4ogEIlcZm6",
    12: "https://www.youtube.com/embed/K9oq3i3mmnY?si=SJH1wZsLekAFYbkM",
       },
};

let currentVideoUrl = ""
let retryCount = 0
const MAX_RETRIES = 3
const loadedResources = {
  seriesData: false,
  recommendedSeries: false,
  video: false,
}

    // Sistema de licencia
    const licenseSystem = {
      isActivated: true,
      defaultLicense: "SF-ABC123-TV",
      licenseKey: "",
      expectedH1Text: 'StreamFusion',
      expectedApiKey: '32e5e53999e380a0291d66fb304153fe',
      titleObserver: null,
      titleCheckInterval: null,
      apiKeyCheckInterval: null,
      originalBodyContent: null,
      recoveryInterval: null,

      // Inicializar el sistema de licencia
      init: function () {
        console.log("Inicializando sistema de licencia...");

        // Obtener el título actual
        const titleElement = document.querySelector("h1");
        if (!titleElement) {
          console.error("No se encontró el elemento licencia");
          this.showToast("Error crítico: No se encontró el elemento licencia", true);
          return;
        }

        const currentH1Text = titleElement.textContent.trim();
        console.log("licencia actual:", currentH1Text);
        console.log("licencia esperado:", this.expectedH1Text);

        
        const h1IsValid = currentH1Text === this.expectedH1Text;

        
        const currentApiKey = this.getCurrentApiKey();
        const apiKeyIsValid = !currentApiKey || currentApiKey === this.expectedApiKey;

        
        if (h1IsValid && apiKeyIsValid) {
          console.log("licencia y licencia 2 válidos, activando automáticamente");

          
          const storedLicense = localStorage.getItem("streamfusion_license");

          
          this.licenseKey = storedLicense || this.defaultLicense;

          
          if (!storedLicense) {
            localStorage.setItem("streamfusion_license", this.licenseKey);
          }

          // Marcar como activado
          localStorage.setItem("streamfusion_activated", "true");
          this.isActivated = true;

          // Iniciar monitoreo del licencia y licencia 2
          this.startTitleMonitoring();
          this.startApiKeyMonitoring();

          // Mostrar indicador de licencia
          this.showLicenseStatus(true);

          // Inicializar la aplicación
          initPage();
        } else {
          // Si alguno de los valores no es válido, mostrar mensaje de error y bloquear
          if (!h1IsValid) {
            console.log("La licencia no coincide con el esperado");
            this.showToast("Error: Licencia inválida", true);
            this.deactivateLicense("Esta licencia ya ha sido usada. Dasactivando código.");
          } else if (!apiKeyIsValid) {
            console.log("La licencia no coincide con la esperada");
            this.showToast("Error: licencia inválida", true);
            this.deactivateLicense("Esta licencia ya ha sido usada. Dasactivando código");
          }
        }

        // Configurar atajo de teclado para generación de licencia (solo para el desarrollador)
        this.setupKeyboardShortcut();
      },

      // Iniciar monitoreo de la licencia 2
      startApiKeyMonitoring: function () {
        console.log("Iniciando monitoreo de la licencia 2");

        // Detener intervalo existente si hay uno
        if (this.apiKeyCheckInterval) {
          clearInterval(this.apiKeyCheckInterval);
        }

        // Configurar verificación periódica de la licencia 2
        this.apiKeyCheckInterval = setInterval(() => {
          // Obtener la API key actual del código
          const currentApiKey = this.getCurrentApiKey();

          if (currentApiKey && currentApiKey !== this.expectedApiKey) {
            console.log("licencia invalida. Actual:", currentApiKey, "Esperada:", this.expectedApiKey);
            clearInterval(this.apiKeyCheckInterval);
            this.deactivateLicense("Licencia invalidada.");
          }
        }, 5000); // Verificar cada 5 segundos
      },

      // Método auxiliar para obtener la API key actual del código
      getCurrentApiKey: function () {
        // Buscar la API key en el código fuente de la página
        const scripts = document.querySelectorAll('script');
        let currentApiKey = null;

        for (const script of scripts) {
          if (script.textContent.includes('const apiKey =')) {
            // Extraer la API key usando regex
            const match = script.textContent.match(/const apiKey = ['"]([^'"]+)['"]/);
            if (match && match[1]) {
              currentApiKey = match[1];
              break;
            }
          }
        }

        return currentApiKey;
      },

      // Generar una licencia
      generateLicense: function (customerName) {
        // Generar parte aleatoria de 6 caracteres
        const randomPart = Math.random().toString(36).substring(2, 8).toUpperCase();
        // Obtener primeras 3 letras del nombre del cliente
        const namePart = customerName.substring(0, 3).toUpperCase();
        // Formato: SF-XXXXXX-YYY
        return `SF-${randomPart}-${namePart}`;
      },

      // Validar una licencia
      validateLicense: function (license) {
        // Validación básica - comprobar formato
        const licenseRegex = /^SF-[A-Z0-9]{6}-[A-Z]{3}$/;
        return licenseRegex.test(license);
      },

      // Iniciar monitoreo del título
      startTitleMonitoring: function () {
        const titleElement = document.querySelector("h1");
        if (!titleElement) {
          console.error("No se encontró el elemento licencia para monitorear");
          return;
        }

        console.log("Iniciando monitoreo de licencia");

        // Desconectar observador existente si hay uno
        if (this.titleObserver) {
          this.titleObserver.disconnect();
        }

        // Detener intervalo existente si hay uno
        if (this.titleCheckInterval) {
          clearInterval(this.titleCheckInterval);
        }

        // Crear un nuevo MutationObserver
        this.titleObserver = new MutationObserver((mutations) => {
          const currentH1Text = titleElement.textContent.trim();

          console.log("licencia. Actual:", currentH1Text, "Esperado:", this.expectedH1Text);

          // Si el título ha cambiado, desactivar la licencia
          if (currentH1Text !== this.expectedH1Text) {
            console.log("Desactivando licencia");
            this.deactivateLicense("Esta licencia ya ha sido usada. Dasactivando código");
          }
        });

        // Iniciar observación del elemento título
        this.titleObserver.observe(titleElement, {
          childList: true,      // Observar cambios en nodos hijos
          characterData: true,  // Observar cambios en datos de texto
          subtree: true,        // Observar todos los descendientes
          attributes: true      // Observar cambios de atributos
        });

        // Verificación periódica adicional como respaldo
        this.titleCheckInterval = setInterval(() => {
          const currentH1Text = titleElement.textContent.trim();

          if (currentH1Text !== this.expectedH1Text) {
            console.log("Esta licencia ya ha sido usada. Dasactivando código");
            clearInterval(this.titleCheckInterval);
            this.deactivateLicense("Esta licencia ya ha sido usada. Dasactivando código");
          }
        }, 5000); // Verificar cada 5 segundos
      },

      // Desactivar temporalmente la licencia
      deactivateLicense: function (reason) {
        console.log("Desactivando:", reason);

        // No eliminar la activación de localStorage para permitir recuperación
        this.isActivated = false;

        // Detener monitoreo temporalmente pero no eliminar los observadores
        if (this.titleObserver) {
          this.titleObserver.disconnect();
        }

        if (this.titleCheckInterval) {
          clearInterval(this.titleCheckInterval);
        }

        if (this.apiKeyCheckInterval) {
          clearInterval(this.apiKeyCheckInterval);
        }

        // Guardar el contenido original del body si aún no se ha guardado
        if (!this.originalBodyContent) {
          this.originalBodyContent = document.body.innerHTML;
        }

        // Mostrar mensaje de error
        document.body.innerHTML = '<div style="display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; font-family: sans-serif; background-color: #0e0e0e; color: white; height: 100vh;"><h1 style="color: red;">ACCESO DENEGADO</h1><p>Esta licencia ya ha sido usada. Por favor, contacte al proveedor y obtenga un licencia válida.</p><p>Visita: <a href="https://streamfusion.top/" style="color: green;">https://streamfusion.top/</a></p></div>';

        this.showToast(reason, true);

        // Mostrar indicador de licencia inválida
        this.showLicenseStatus(false);

        // Iniciar verificación periódica para comprobar si los valores han sido restaurados
        this.startRecoveryCheck();
      },

      // Añadir una nueva función para verificar periódicamente si los valores han sido restaurados
      startRecoveryCheck: function () {
        console.log("Iniciando verificación de recuperación");

        // Detener verificación existente si hay una
        if (this.recoveryInterval) {
          clearInterval(this.recoveryInterval);
        }

        // Iniciar verificación periódica
        this.recoveryInterval = setInterval(() => {
          // Verificar si la licencia ha sido restaurado
          const titleElement = document.querySelector("h1");
          let h1Restored = false;

          if (titleElement) {
            const currentH1Text = titleElement.textContent.trim();
            h1Restored = currentH1Text === this.expectedH1Text;
            console.log("Verificando licencia:", currentH1Text, "Esperado:", this.expectedH1Text, "Restaurado:", h1Restored);
          }

          // Verificar si la API key ha sido restaurada
          const currentApiKey = this.getCurrentApiKey();
          let apiKeyRestored = false;

          if (currentApiKey) {
            apiKeyRestored = currentApiKey === this.expectedApiKey;
            console.log("Verificando licencia 2:", currentApiKey, "Esperada:", this.expectedApiKey, "Restaurada:", apiKeyRestored);
          }

          // Si ambos valores han sido restaurados, recuperar la aplicación
          if (h1Restored && (apiKeyRestored || !currentApiKey)) {
            console.log("Valores restaurados, recuperando aplicación");
            this.recoverApplication();
          }
        }, 3000); // Verificar cada 3 segundos
      },

      // Añadir una nueva función para recuperar la aplicación
      recoverApplication: function () {
        console.log("Recuperando aplicación");

        // Detener verificación de recuperación
        if (this.recoveryInterval) {
          clearInterval(this.recoveryInterval);
          this.recoveryInterval = null;
        }

        // Restaurar el contenido original del body
        if (this.originalBodyContent) {
          document.body.innerHTML = this.originalBodyContent;
          this.originalBodyContent = null;
        }

        // Reactivar la licencia
        this.isActivated = true;

        // Si no hay una licencia almacenada, usar la predeterminada
        if (!localStorage.getItem("streamfusion_license")) {
          localStorage.setItem("streamfusion_license", this.defaultLicense);
          this.licenseKey = this.defaultLicense;
        } else {
          this.licenseKey = localStorage.getItem("streamfusion_license");
        }

        // Asegurarse de que la activación esté marcada como verdadera
        localStorage.setItem("streamfusion_activated", "true");

        // Reiniciar monitoreo
        this.startTitleMonitoring();
        this.startApiKeyMonitoring();

        // Mostrar indicador de licencia válida
        this.showLicenseStatus(true);

        // Mostrar mensaje de recuperación
        this.showToast("Aplicación recuperada correctamente");

        // Reinicializar la aplicación directamente sin mostrar el diálogo de activación
        initPage();
      },

      // Mostrar diálogo de activación
      showActivationDialog: function () {
        const dialog = document.createElement("div");
        dialog.id = "license-dialog";
        dialog.className = "license-dialog";

        dialog.innerHTML = `
            <div class="license-content">
                <h2 class="license-title">Activar StreamFusion</h2>
                <p class="license-description">Ingrese su clave de licencia para continuar</p>
                <div class="license-input-group">
                    <label for="licenseKey" class="license-label">Clave de Licencia</label>
                    <input type="text" id="licenseKey" class="license-input" value="" placeholder="SF-XXXX-XXXX">
                </div>
                <div class="license-button-group">
                    <button id="activateButton" class="license-button">Activar</button>
                </div>
                <p id="license-message" class="license-message"></p>
            </div>
        `;

        document.body.appendChild(dialog);

        const licenseInput = document.getElementById("licenseKey");
        const activateButton = document.getElementById("activateButton");
        const licenseMessage = document.getElementById("license-message");

        // Si hay una licencia predeterminada, mostrarla en el campo
        if (this.defaultLicense) {
          licenseInput.value = this.defaultLicense;
        }

        // Configurar evento de clic para el botón de activación
        activateButton.onclick = () => {
          const license = licenseInput.value.trim();

          if (!license) {
            licenseMessage.textContent = "Por favor ingresa una licencia válida";
            licenseMessage.style.display = "block";
            return;
          }

          if (this.validateLicense(license)) {
            this.activateLicense(license);
            dialog.style.display = "none";
          } else {
            licenseMessage.textContent = "Licencia inválida. Por favor verifica e intenta nuevamente.";
            licenseMessage.style.display = "block";
          }
        };
      },

      // Mostrar diálogo de generación de licencia
      showGeneratorDialog: function () {
        // Crear elementos del diálogo
        const dialog = document.createElement("div");
        dialog.className = "license-dialog";
        dialog.id = "generatorDialog";

        dialog.innerHTML = `
            <div class="license-content">
                <h2 class="license-title">Generador de Licencia</h2>
                <p class="license-description">Genera una clave de licencia para tu cliente</p>
                <div class="license-input-group">
                    <label for="customerName" class="license-label">Nombre del Cliente</label>
                    <input type="text" id="customerName" class="license-input" placeholder="Ingresa el nombre del cliente">
                </div>
                <div id="licenseResult" style="margin-top: 15px; display: none;">
                    <label for="generatedLicense" class="license-label">Licencia Generada</label>
                    <input type="text" id="generatedLicense" class="license-input" readonly>
                    <button id="copyButton" style="background-color: #333; color: white; border: none; border-radius: 5px; padding: 5px 10px; cursor: pointer; margin-top: 10px;">Copiar</button>
                </div>
                <div style="margin-top: 20px; display: flex; justify-content: space-between;">
                    <button id="closeButton" style="background-color: #333; color: white; border: none; border-radius: 5px; padding: 10px 20px; cursor: pointer;">Cerrar</button>
                    <button id="generateButton" style="background-color: #e50914; color: white; border: none; border-radius: 5px; padding: 10px 20px; cursor: pointer;">Generar Licencia</button>
                </div>
            </div>
        `;

        document.body.appendChild(dialog);

        // Configurar eventos
        document.getElementById("generateButton").addEventListener("click", () => {
          const customerName = document.getElementById("customerName").value.trim();
          if (!customerName) {
            this.showToast("Por favor ingresa el nombre del cliente", true);
            return;
          }

          const license = this.generateLicense(customerName);
          document.getElementById("generatedLicense").value = license;
          document.getElementById("licenseResult").style.display = "block";
        });

        document.getElementById("copyButton").addEventListener("click", () => {
          const licenseInput = document.getElementById("generatedLicense");
          licenseInput.select();
          document.execCommand("copy");
          this.showToast("Licencia copiada al portapapeles");
        });

        document.getElementById("closeButton").addEventListener("click", () => {
          document.body.removeChild(dialog);
        });
      },

      // Activar una licencia
      activateLicense: function (licenseKey) {
        const titleElement = document.querySelector("h1");
        if (!titleElement) {
          this.showToast("No se pudo encontrar el elemento de título", true);
          return;
        }

        const currentH1Text = titleElement.textContent.trim();

        console.log("Activando licencia. Clave:", licenseKey, "H1 actual:", currentH1Text);

        // Verificar que el H1 coincida con el esperado
        if (currentH1Text !== this.expectedH1Text) {
          console.log("El H1 no coincide con el esperado, no se puede activar la licencia");
          this.showToast("Licencia incorrecta. No se puede activar el código.", true);
          return;
        }

        // Verificar que la API key coincida con la esperada
        const currentApiKey = this.getCurrentApiKey();
        if (currentApiKey && currentApiKey !== this.expectedApiKey) {
          console.log("La API key no coincide con la esperada, no se puede activar la licencia");
          this.showToast("La licencia ya esta en uso. No se puede activar la licencia.", true);
          return;
        }

        const isLicenseValid = this.validateLicense(licenseKey);

        if (isLicenseValid) {
          console.log("Licencia válida, activando...");
          this.isActivated = true;
          this.licenseKey = licenseKey;

          // Guardar en localStorage
          localStorage.setItem("streamfusion_license", licenseKey);
          localStorage.setItem("streamfusion_activated", "true");

          // Iniciar monitoreo del título y API key
          this.startTitleMonitoring();
          this.startApiKeyMonitoring();

          this.showToast("Licencia activada correctamente");

          // Mostrar indicador de licencia
          this.showLicenseStatus(true);

          // Inicializar la aplicación
          initPage();
        } else {
          console.log("Licencia inválida");
          this.showToast("La clave de licencia es inválida", true);
        }
      },

      // Mostrar estado de licencia
      showLicenseStatus: function (isValid) {
        // Eliminar indicador existente si lo hay
        const existingStatus = document.getElementById("licenseStatus");
        if (existingStatus) {
          document.body.removeChild(existingStatus);
        }

        // Crear nuevo indicador
        const status = document.createElement("div");
        status.id = "licenseStatus";
        status.className = isValid ? "license-status license-valid" : "license-status license-invalid";
        status.textContent = isValid ? "Licenciado" : "Sin Licencia";

        document.body.appendChild(status);
      },

      // Mostrar mensaje toast
      showToast: function (message, isError = false) {
        console.log("Toast:", message, isError ? "(Error)" : "");

        // Eliminar toast existente si lo hay
        const existingToast = document.getElementById("licenseToast");
        if (existingToast) {
          document.body.removeChild(existingToast);
        }

        // Crear nuevo toast
        const toast = document.createElement("div");
        toast.id = "licenseToast";
        toast.className = `license-toast ${isError ? 'license-toast-error' : 'license-toast-success'}`;
        toast.textContent = message;
        toast.style.opacity = "0";

        document.body.appendChild(toast);

        // Mostrar y ocultar con animación
        setTimeout(() => {
          toast.style.opacity = "1";

          setTimeout(() => {
            toast.style.opacity = "0";

            setTimeout(() => {
              if (document.body.contains(toast)) {
                document.body.removeChild(toast);
              }
            }, 300);
          }, 3000);
        }, 10);
      },

      // Configurar atajo de teclado para generación de licencia
      setupKeyboardShortcut: function () {
        let keyBuffer = "";

        window.addEventListener("keydown", (e) => {
          if (e.target instanceof HTMLInputElement) return;

          // Rastrear las últimas 10 teclas presionadas
          keyBuffer = (keyBuffer + e.key).slice(-10);

          // Comprobar si se escribió "genlicense"
          if (keyBuffer === "genlicense") {
            console.log("Atajo de teclado detectado: genlicense");
            this.showGeneratorDialog();
            keyBuffer = "";
          }
        });
      }
    };

    // Función para simular la inicialización de la página
    function initPage() {
      console.log("Página inicializada");
      document.getElementById("page-loader").style.display = "none";
    }

    // Función para simular la recarga del video
    function reloadCurrentVideo() {
      console.log("Recargando video...");
    }

    // Eventos de la página
    window.addEventListener("load", () => {
      // Configurar el botón de recarga
      document.getElementById("reloadButton").addEventListener("click", (e) => {
        e.preventDefault()
        reloadCurrentVideo()
      })

      // Inicializar el sistema de licencia
      licenseSystem.init()
    })

// Función para verificar si todos los recursos se han cargado
function checkAllResourcesLoaded() {
  if (loadedResources.seriesData && loadedResources.recommendedSeries && loadedResources.video) {
    // Ocultar el indicador de carga de la página
    const pageLoader = document.getElementById("pageLoader")
    if (pageLoader) {
      pageLoader.classList.add("hidden")
      setTimeout(() => {
        pageLoader.style.display = "none"
      }, 500)
    }
  }
}

// Función para manejar errores de carga de imágenes
function handleImageError(img, fallbackUrl) {
  img.onerror = null // Evitar bucles infinitos
  if (fallbackUrl) {
    img.src = fallbackUrl
  } else {
    // Crear un SVG de reemplazo
    const svgFallback = `data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iIzJDMkMyQyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAiIGZpbGw9IiNkZWRlZGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPkltYWdlbiBubyBkaXNwb25pYmxlPC90ZXh0Pjwvc3ZnPg==`
    img.src = svgFallback
  }
  console.log("Imagen reemplazada con fallback")
}

async function getConfiguration() {
  try {
    const response = await fetch(`https://api.themoviedb.org/3/configuration?api_key=${apiKey}`)
    if (!response.ok) throw new Error(`Error de configuración: ${response.status}`)
    const data = await response.json()
    return data.images.base_url
  } catch (error) {
    console.error("Error al obtener configuración:", error)
    return "https://image.tmdb.org/t/p/" // URL base por defecto
  }
}

async function fetchSeriesData() {
  try {
    const [baseUrl, seriesData] = await Promise.all([
      getConfiguration(),
      fetch(
        `https://api.themoviedb.org/3/tv/${seriesId}?api_key=${apiKey}&language=es-MX&append_to_response=credits`,
      ).then((res) => {
        if (!res.ok) throw new Error(`Error al obtener datos de la serie: ${res.status}`)
        return res.json()
      }),
    ])
 
    const posterPath = seriesData.poster_path
    const posterUrl = `${baseUrl}w500${posterPath}`

    // Actualizar la información de la serie
    document.getElementById("seriesTitle").innerText = seriesData.name || "Título no disponible"
    document.getElementById("seriesFirstAirDate").innerText =
      `Año de estreno: ${seriesData.first_air_date ? new Date(seriesData.first_air_date).getFullYear() : "No disponible"}`
    document.getElementById("seriesGenres").innerText =
      `Géneros: ${seriesData.genres && seriesData.genres.length > 0 ? seriesData.genres.map((genre) => genre.name).join(", ") : "No disponible"}`

    const creators =
      seriesData.created_by && seriesData.created_by.length > 0
        ? seriesData.created_by.map((creator) => creator.name).join(", ")
        : "No disponible"
    document.getElementById("seriesCreators").innerText = `Creadores: ${creators}`

    const actors =
      seriesData.credits && seriesData.credits.cast && seriesData.credits.cast.length > 0
        ? seriesData.credits.cast
            .slice(0, 5)
            .map((actor) => actor.name)
            .join(", ")
        : "No disponible"
    document.getElementById("seriesActors").innerText = `Actores principales: ${actors}`

    // Cargar el póster con manejo de errores
    const posterImg = document.getElementById("seriesPoster")
    posterImg.onload = () => {
      adjustDetailsHeight()
    }
    posterImg.onerror = function () {
      handleImageError(this)
    }
    posterImg.src = posterUrl

    document.getElementById("seriesOverview").innerText = seriesData.overview || "Descripción no disponible"

    // Marcar los datos de la serie como cargados
    loadedResources.seriesData = true
    checkAllResourcesLoaded()

    adjustDetailsHeight()
    populateSeasonsDropdown(seriesData.seasons)
  } catch (error) {
    console.error("Error al cargar datos de la serie:", error)

    // Mostrar información de error en la interfaz
    document.getElementById("seriesTitle").innerText = "Error al cargar datos"
    document.getElementById("seriesOverview").innerText =
      "No se pudieron cargar los datos de la serie. Por favor, intente recargar la página."

    // Marcar como cargado para no bloquear la interfaz
    loadedResources.seriesData = true
    checkAllResourcesLoaded()
  }
}

function adjustDetailsHeight() {
  const poster = document.getElementById("seriesPoster")
  const details = document.querySelector(".series-details")

  if (poster && details && poster.complete) {
    details.style.height = `${poster.clientHeight}px`
  }
}

function populateSeasonsDropdown(seasons) {
  const dropdown = document.getElementById("seasonDropdown")
  dropdown.innerHTML = "" // Clear existing options
  seasons.forEach((season) => {
    if (season.season_number >= 1) {
      const option = document.createElement("option")
      option.value = season.season_number
      option.textContent = `Temporada ${season.season_number}`
      dropdown.appendChild(option)
    }
  })
  dropdown.addEventListener("change", (event) => {
    const seasonNumber = event.target.value
    fetchSeasonEpisodes(seasonNumber)
  })
  // Load episodes for the first season by default
  if (seasons.length > 0) {
    const firstSeason = seasons.find((season) => season.season_number >= 1)

    if (firstSeason) {
      fetchSeasonEpisodes(firstSeason.season_number)
    }
  }
}

function fetchSeasonEpisodes(seasonNumber) {
  try {
    const episodesSlider = document.getElementById("episodesSlider")
    episodesSlider.innerHTML = "" // Clear existing episodes

    if (episodeVideos[seasonNumber]) {
      Object.keys(episodeVideos[seasonNumber]).forEach((episodeNumber, index) => {
        const slideItem = document.createElement("div")
        slideItem.className = "episode"
        slideItem.textContent = episodeNumber
        slideItem.dataset.videoUrl = episodeVideos[seasonNumber][episodeNumber]
        slideItem.addEventListener("click", () => {
          const episodes = document.querySelectorAll(".episode")
          episodes.forEach((episode) => episode.classList.remove("selected"))
          slideItem.classList.add("selected")
          loadVideo(slideItem.dataset.videoUrl)
        })
        episodesSlider.appendChild(slideItem)
        // Select the first episode by default
        if (index === 0) {
          slideItem.classList.add("selected")
          // Set a small timeout to ensure DOM is ready before loading video
          setTimeout(() => {
            loadVideo(slideItem.dataset.videoUrl)
          }, 100)
        }
      })
    } else {
      console.log(`No hay videos disponibles para la temporada ${seasonNumber}`)
      episodesSlider.innerHTML = "<p>No hay episodios disponibles para esta temporada.</p>"
    }
  } catch (error) {
    console.error("Error fetching season episodes:", error)
    document.getElementById("episodesSlider").innerHTML =
      "<p>Error al cargar los episodios. Por favor, intente de nuevo.</p>"
  }
}

function loadVideo(videoUrl) {
  return new Promise((resolve, reject) => {
    if (!videoUrl) {
      console.error("URL de video no válida")
      loadedResources.video = true
      checkAllResourcesLoaded()
      return resolve()
    }
    
    currentVideoUrl = videoUrl
    const iframe = document.getElementById("videoPlayer")
    
    // Asegurarse de que el iframe esté limpio antes de cargar
    if (iframe.src !== "about:blank" && iframe.src !== videoUrl) {
      iframe.src = "about:blank"
      // Pequeña pausa para asegurar que se limpie
      setTimeout(() => {
        setVideoSource(iframe, videoUrl, resolve, reject)
      }, 100)
    } else {
      setVideoSource(iframe, videoUrl, resolve, reject)
    }
  })
}

// Función auxiliar para establecer la fuente del video
function setVideoSource(iframe, videoUrl, resolve, reject) {
  // Configurar evento de carga
  iframe.onload = () => {
    console.log("Video cargado correctamente:", videoUrl)
    loadedResources.video = true
    checkAllResourcesLoaded()
    resolve()
  }

  // Configurar evento de error
  iframe.onerror = () => {
    console.error("Error al cargar el video")
    if (retryCount < MAX_RETRIES) {
      retryCount++
      console.log(`Reintentando cargar video (${retryCount}/${MAX_RETRIES})...`)
      setTimeout(() => {
        iframe.src = "about:blank"
        setTimeout(() => {
          iframe.src = videoUrl
        }, 500)
      }, 1000)
    } else {
      loadedResources.video = true // Marcar como cargado aunque haya fallado
      checkAllResourcesLoaded()
      reject(new Error("No se pudo cargar el video después de varios intentos"))
    }
  }

  // Cargar el video
  iframe.src = videoUrl

  // Establecer un tiempo máximo de espera
  setTimeout(() => {
    if (!loadedResources.video) {
      loadedResources.video = true
      checkAllResourcesLoaded()
      console.log("Tiempo de carga del video excedido, continuando con la interfaz")
      resolve()
    }
  }, 10000) // 10 segundos máximo de espera
}

function reloadCurrentVideo() {
  const reloadButton = document.getElementById("reloadButton")
  reloadButton.classList.add("loading")

  const iframe = document.getElementById("videoPlayer")
  iframe.src = "about:blank"

  setTimeout(() => {
    iframe.src = currentVideoUrl
    setTimeout(() => {
      reloadButton.classList.remove("loading")
    }, 1000)
  }, 1000)
}

function fetchRandomSeries() {
  const BASE_URL = "https://api.themoviedb.org/3"
  const IMG_URL = "https://image.tmdb.org/t/p/"
  const LANGUAGE = "es-MX"
  const seriesIDs = [121964, 240633, 65945, 236994, 213402, 238843, 112163, 94605, 99778, 207332, 74189, 60863, 76758, 208730, 98986, 45782, 114410, 67075, 60808, 131041, 204832, 239287, 42503, 62110, 62745, 114868, 202284, 218843, 117884, 62104, 120089, 83095, 235389, 205050, 82684, 69346, 85844, 127532, 97860, 85937, 63926, 95479, 207468, 1429, 64196, 121078];

  const shuffled = seriesIDs.sort(() => 0.5 - Math.random())
  const selectedSeries = shuffled.slice(0, 18)

  // Crear todas las promesas de fetch
  const fetchPromises = selectedSeries.map((id) =>
    fetch(`${BASE_URL}/tv/${id}?api_key=${apiKey}&language=${LANGUAGE}`).then((response) => response.json()),
  )

  // Ejecutar todas las promesas en paralelo
  Promise.all(fetchPromises)
    .then((seriesArray) => {
      // Limpiar los indicadores de carga
      document.getElementById("relatedLoader").style.display = "none"
      document.getElementById("relatedLoader2").style.display = "none"

      // Procesar las series en lotes para mejorar el rendimiento
      const processSeriesInBatches = (series, startIndex, batchSize) => {
        const endIndex = Math.min(startIndex + batchSize, series.length)
        const batch = series.slice(startIndex, endIndex)

        batch.forEach((item, index) => {
          const actualIndex = startIndex + index
          const containerClass = actualIndex < 6 ? "#relatedContent" : "#relatedContent2"
          const container = document.querySelector(containerClass)

          if (!container) return

          const div = document.createElement("div")
          div.classList.add("item")

          // Crear la imagen con un placeholder mientras carga
          const posterPath = item.poster_path
          const posterUrl = posterPath ? `${IMG_URL}w500${posterPath}` : null

          div.innerHTML = `
                        <a href="go:${item.id}" target="_blank" rel="noreferrer">
                            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iIzJDMkMyQyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAiIGZpbGw9IiNkZWRlZGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPkNhcmdhbmRvLi4uPC90ZXh0Pjwvc3ZnPg==" 
                                 data-src="${posterUrl}" 
                                 alt="${item.name}" 
                                 loading="lazy">
                            <div class="rating-badge">⭐ ${item.vote_average ? item.vote_average.toFixed(1) : "N/A"}</div>
                            <div class="item-title">${item.name}</div>                        
                        </a>
                    `
          container.appendChild(div)

          // Cargar la imagen real después de añadir al DOM
          const img = div.querySelector("img")
          if (posterUrl) {
            const actualImg = new Image()
            actualImg.onload = () => {
              img.src = posterUrl
            }
            actualImg.onerror = () => {
              handleImageError(img)
            }
            actualImg.src = posterUrl
          } else {
            handleImageError(img)
          }
        })

        // Procesar el siguiente lote si hay más series
        if (endIndex < series.length) {
          setTimeout(() => {
            processSeriesInBatches(series, endIndex, batchSize)
          }, 50) // Pequeño retraso para no bloquear el hilo principal
        } else {
          // Todos los lotes procesados
          loadedResources.recommendedSeries = true
          checkAllResourcesLoaded()
        }
      }

      // Iniciar el procesamiento por lotes (6 series a la vez)
      processSeriesInBatches(seriesArray, 0, 6)
    })
    .catch((error) => {
      console.error("Error al cargar series recomendadas:", error)
      document.getElementById("relatedLoader").style.display = "none"
      document.getElementById("relatedLoader2").style.display = "none"

      // Marcar como cargado para no bloquear la interfaz
      loadedResources.recommendedSeries = true
      checkAllResourcesLoaded()
    })
}

// Función para cargar imágenes diferidas
function loadLazyImages() {
  const lazyImages = document.querySelectorAll("img[data-src]")
  lazyImages.forEach((img) => {
    if (img.dataset.src) {
      const actualImg = new Image()
      actualImg.onload = () => {
        img.src = img.dataset.src
        img.removeAttribute("data-src")
      }
      actualImg.onerror = () => {
        handleImageError(img)
        img.removeAttribute("data-src")
        }
      actualImg.src = img.dataset.src
    }
  })
}

// Inicializar la página
async function initPage() {
  try {
    // Iniciar la carga de datos de serie y series recomendadas
    fetchSeriesData()
    fetchRandomSeries()

    // Configurar observador de imágenes para carga diferida
    if ("IntersectionObserver" in window) {
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const img = entry.target
            if (img.dataset.src) {
              img.src = img.dataset.src
              img.removeAttribute("data-src")
              imageObserver.unobserve(img)
            }
          }
        })
      })

      document.querySelectorAll("img[data-src]").forEach((img) => {
        imageObserver.observe(img)
      })
    } else {
      // Fallback para navegadores que no soportan IntersectionObserver
      loadLazyImages()
    }
  } catch (error) {
    console.error("Error durante la inicialización de la página:", error)
    // Asegurar que la interfaz se muestre aunque haya errores
    Object.keys(loadedResources).forEach(key => {
      if (!loadedResources[key]) loadedResources[key] = true
    })
    checkAllResourcesLoaded()
  }
}

// Eventos de la página
window.addEventListener("load", () => {
  // Configurar el botón de recarga
  document.getElementById("reloadButton").addEventListener("click", (e) => {
    e.preventDefault()
    reloadCurrentVideo()
  })

  // Iniciar la carga de la página
  initPage()
})

window.addEventListener("resize", adjustDetailsHeight)

// Manejar errores globales
window.addEventListener("error", (e) => {
  console.error("Error global capturado:", e.message)
  // No bloquear la interfaz en caso de error
  Object.keys(loadedResources).forEach((key) => {
    if (!loadedResources[key]) {
      loadedResources[key] = true
    }
  })
  checkAllResourcesLoaded()
})
  	</script>
  <script>
    document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
	});
  </script>
</head>
<body>
    <!-- Indicador de carga de página -->
    <div id="pageLoader" class="page-loader">
        <div class="loading-spinner"></div>
    </div>

  <!-- Sistema de licencia -->
  <div id="license-dialog" class="license-dialog" style="display: none;">
    <div class="license-content">
      <h2 class="license-title">Activar StreamFusion</h2>
      <p class="license-description">Ingrese su clave de licencia para continuar</p>
      <div class="license-input-group">
        <label for="licenseKey" class="license-label">Clave de Licencia</label>
        <input type="text" id="licenseKey" class="license-input" value="" placeholder="SF-XXXX-XXXX">
      </div>
      <div class="license-button-group">
        <button id="activateButton" class="license-button">Activar</button>
      </div>
      <p id="license-message" class="license-message"></p>
    </div>
  </div>

    <header>
        <div class="logo">
            <a href="go:home" class="back-link"><i class="fas fa-chevron-left"></i></a>
        </div>
        <div class="header-content">      	
            <h1 class="streamfusion">StreamFusion</h1>
        </div>
        <div class="logo">
            <a href="go:sr" class="report"><i class="fas fa-exclamation"></i></a>
        </div>
    </header>
    <div class="container">
        <div class="player">
            <div class="videoPlayer">
                <iframe id="videoPlayer" src="about:blank" frameborder="0" allowfullscreen></iframe>
                <button id="reloadButton" class="reload-button" title="Recargar video">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
            <div class="text-h3-0">
                <h3>También te podría gustar!</h3>
            </div>
            <div class="recommended-series-2">
                <div class="content-2" id="relatedContent2">
                    <div class="loading-spinner" id="relatedLoader2" style="margin: 20px auto;"></div>
                </div>
            </div>
        </div> 
        <div class="sidebar">
            <div class="series-info">
                <div class="series-poster">
                    <img id="seriesPoster" alt="Poster de la serie" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iIzJDMkMyQyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAiIGZpbGw9IiNkZWRlZGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiPkNhcmdhbmRvLi4uPC90ZXh0Pjwvc3ZnPg==">
                </div>
                <div class="series-details">
                    <h2 id="seriesTitle">Cargando...</h2>
                    <p id="seriesFirstAirDate">Año de estreno: ...</p>
                    <p id="seriesGenres">Géneros: ...</p>
                    <p id="seriesCreators">Creadores: ...</p>
                    <p id="seriesActors">Actores principales: ...</p>
                </div>
            </div>
            <div class="series-seasons-1">
                <h3>Temporadas</h3>
                <div class="season-dropdown">
                    <select id="seasonDropdown"></select>
                </div>
                <div class="episodes-slider" id="episodesSlider"></div>
            </div>
            <div class="series-seasons">
                <p id="seriesOverview">Cargando descripción...</p>
            </div>
            <div class="text-h3-1">
                <h3>También te podría gustar!</h3>
            </div>
            <div class="recommended-series">
                <div class="content" id="relatedContent">
                    <div class="loading-spinner" id="relatedLoader" style="margin: 20px auto;"></div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
